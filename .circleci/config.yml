%YAML 1.1
---
version: '2'
workflows:
  version: 2
  test:
    jobs:
    - test-3.8-stage:
        context: z7-stage
        filters:
          branches:
            only: /z7-stage.*/
    - test-3.8-prod:
        context: z7-prod
        filters:
          branches:
            only: /z7-prod.*/
    - test-3.9-stage:
        context: z7-stage
        filters:
          branches:
            only: /z7-stage.*/
    - test-3.9-prod:
        context: z7-prod
        filters:
          branches:
            only: /z7-prod.*/
jobs:
  test-3.8-stage:
    environment:
      COLUMNS: '160'
      # default is /usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      PATH: /root/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      COVER_PACKAGES: geometry,geometry.basic_utils,geometry.constants,geometry.distances,geometry.distances.generic,geometry.distances.spherical,geometry.formatting,geometry.manifolds,geometry.manifolds.differentiable_manifold,geometry.manifolds.embedding_relations,geometry.manifolds.euclidean,geometry.manifolds.exceptions,geometry.manifolds.group,geometry.manifolds.manifold_embedding_propagation,geometry.manifolds.manifold_relations,geometry.manifolds.matrix_lie_algebra,geometry.manifolds.matrix_lie_group,geometry.manifolds.matrix_lie_group_tangent,geometry.manifolds.matrix_linear_space,geometry.manifolds.point_set,geometry.manifolds.product_manifold,geometry.manifolds.special_euclidean_algebra,geometry.manifolds.special_euclidean_group,geometry.manifolds.special_orthogonal_algebra,geometry.manifolds.special_orthogonal_group,geometry.manifolds.sphere,geometry.manifolds.square,geometry.manifolds.tangent_bundle,geometry.manifolds.tests,geometry.manifolds.tests.checks_generation,geometry.manifolds.tests.embedding_test,geometry.manifolds.tests.manifold_tests,geometry.manifolds.tests.matrix_groups_tests,geometry.manifolds.tests.pickling_tests,geometry.manifolds.tests.sphere_tests,geometry.manifolds.todo,geometry.manifolds.todo.grassman,geometry.manifolds.todo.moebius,geometry.manifolds.todo.orthogonal_group,geometry.manifolds.todo.posdef_matrices,geometry.manifolds.todo.stiefel,geometry.manifolds.torus,geometry.manifolds.torus01,geometry.manifolds.translation_algebra,geometry.manifolds.translation_group,geometry.mds_algos,geometry.poses,geometry.poses_embedding,geometry.procrustes,geometry.rotations,geometry.rotations_embedding,geometry.spheres,geometry.spheres_embedding,geometry.subspaces,geometry.subspaces.subspaces,geometry.tex,geometry.types,geometry.unittests,geometry.unittests.distances_test,geometry.unittests.mds_test,geometry.unittests.misc_tests,geometry.unittests.poses_test,geometry.unittests.procrustes_test,geometry.unittests.quaternions_test,geometry.unittests.random_geometry_density_tests,geometry.unittests.random_geometry_tests,geometry.unittests.rotations_tests,geometry.unittests.spheres_tests,geometry.unittests.uniform_dist_pvalue_paranoia,geometry.unittests.utils,geometry.unittests.utils_test,geometry.utils,geometry.utils.numpy_backport,geometry.yaml_
      TEST_PACKAGES: geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry
    docker:
    - image: ${DOCKER_REGISTRY}/zupermind/zuper-ci-3.8:z7
      auth:
        username: $DOCKER_USERNAME
        password: $DOCKER_PASSWORD
    working_directory: ~/repo
    steps:
    - checkout
    - run:
        name: Build statistics
        command: |
          mkdir -p build-stats
          env | sort | tee  build-stats/env.txt
    - store_artifacts:
        path: build-stats
        destination: build-stats
    - run:
        name: Install deps
        command: |
          shyaml get-values install_requires < project.pp1.yaml > .requirements.txt
          python3 -m pip install -U pip
          python3 -m pip install  -r .requirements.txt
          rm .requirements.txt

    - run:
        name: Install testing deps
        command: |
          shyaml get-values tests_require < project.pp1.yaml > .requirements_tests.txt
          python3 -m pip  install -r .requirements_tests.txt
          rm .requirements_tests.txt

    - run:
        name: Python stats
        when: always
        command: |
          pipdeptree | tee  build-stats/pipdeptree.txt
          python3 -m pip  list   | sort | tee  build-stats/pip-list.txt
          python3 -m pip  freeze | sort | tee  build-stats/pip-freeze.txt

    - store_artifacts:
        path: build-stats
        destination: build-stats

    - run:
        name: setup.py develop
        command: |
          pip install -e . --prefix ~/.local --no-deps

    - run:
        name: Make docs
        command: |
          FILE=src/conf.py
          mkdir -p out/docs
          if test -f "$FILE"; then
              sphinx-build src out/docs
          fi

    - store_artifacts:
        path: out/docs
        destination: docs
    - run:
        background: true
        name: services
        command: |
          TARGET=services
          if make -n $TARGET ; then
              make $TARGET
          else
              echo "Target $TARGET not defined"
          fi
    - run:
        name: pre-circle-tests
        command: |
          TARGET=pre-circle-tests
          if make -n $TARGET ; then
              make $TARGET
          else
              echo "Target $TARGET not defined"
          fi


    # - run:
    #     name: Notebooks
    #     command: |
    #       make -C notebooks cleanup all


    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: post-circle-tests
        command: |
          TARGET=post-circle-tests
          if make -n $TARGET ; then
              make $TARGET
          else
              echo "Target $TARGET not defined"
          fi

    - store_test_results:
        path: out/test-results

    - run:
        name: Coverage report
        when: always
        command: |
          coverage combine || true
          coverage html -d out/coverage/${CIRCLE_NODE_INDEX}
          coverage xml

    - store_artifacts:
        path: out/coverage
        destination: coverage

    - store_artifacts:
        path: out/tests
        destination: tests

    - run:
        name: CodeCov
        when: always
        command: |
          bash <(curl -s https://codecov.io/bash)
    resource_class: medium
  test-3.8-prod:
    environment:
      COLUMNS: '160'
      # default is /usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      PATH: /root/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      COVER_PACKAGES: geometry,geometry.basic_utils,geometry.constants,geometry.distances,geometry.distances.generic,geometry.distances.spherical,geometry.formatting,geometry.manifolds,geometry.manifolds.differentiable_manifold,geometry.manifolds.embedding_relations,geometry.manifolds.euclidean,geometry.manifolds.exceptions,geometry.manifolds.group,geometry.manifolds.manifold_embedding_propagation,geometry.manifolds.manifold_relations,geometry.manifolds.matrix_lie_algebra,geometry.manifolds.matrix_lie_group,geometry.manifolds.matrix_lie_group_tangent,geometry.manifolds.matrix_linear_space,geometry.manifolds.point_set,geometry.manifolds.product_manifold,geometry.manifolds.special_euclidean_algebra,geometry.manifolds.special_euclidean_group,geometry.manifolds.special_orthogonal_algebra,geometry.manifolds.special_orthogonal_group,geometry.manifolds.sphere,geometry.manifolds.square,geometry.manifolds.tangent_bundle,geometry.manifolds.tests,geometry.manifolds.tests.checks_generation,geometry.manifolds.tests.embedding_test,geometry.manifolds.tests.manifold_tests,geometry.manifolds.tests.matrix_groups_tests,geometry.manifolds.tests.pickling_tests,geometry.manifolds.tests.sphere_tests,geometry.manifolds.todo,geometry.manifolds.todo.grassman,geometry.manifolds.todo.moebius,geometry.manifolds.todo.orthogonal_group,geometry.manifolds.todo.posdef_matrices,geometry.manifolds.todo.stiefel,geometry.manifolds.torus,geometry.manifolds.torus01,geometry.manifolds.translation_algebra,geometry.manifolds.translation_group,geometry.mds_algos,geometry.poses,geometry.poses_embedding,geometry.procrustes,geometry.rotations,geometry.rotations_embedding,geometry.spheres,geometry.spheres_embedding,geometry.subspaces,geometry.subspaces.subspaces,geometry.tex,geometry.types,geometry.unittests,geometry.unittests.distances_test,geometry.unittests.mds_test,geometry.unittests.misc_tests,geometry.unittests.poses_test,geometry.unittests.procrustes_test,geometry.unittests.quaternions_test,geometry.unittests.random_geometry_density_tests,geometry.unittests.random_geometry_tests,geometry.unittests.rotations_tests,geometry.unittests.spheres_tests,geometry.unittests.uniform_dist_pvalue_paranoia,geometry.unittests.utils,geometry.unittests.utils_test,geometry.utils,geometry.utils.numpy_backport,geometry.yaml_
      TEST_PACKAGES: geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry
    docker:
    - image: ${DOCKER_REGISTRY}/zupermind/zuper-ci-3.8:z7
      auth:
        username: $DOCKER_USERNAME
        password: $DOCKER_PASSWORD
    working_directory: ~/repo
    steps:
    - checkout
    - run:
        name: Build statistics
        command: |
          mkdir -p build-stats
          env | sort | tee  build-stats/env.txt
    - store_artifacts:
        path: build-stats
        destination: build-stats
    - run:
        name: Install deps
        command: |
          shyaml get-values install_requires < project.pp1.yaml > .requirements.txt
          python3 -m pip install -U pip
          python3 -m pip install  -r .requirements.txt
          rm .requirements.txt

    - run:
        name: Install testing deps
        command: |
          shyaml get-values tests_require < project.pp1.yaml > .requirements_tests.txt
          python3 -m pip  install -r .requirements_tests.txt
          rm .requirements_tests.txt

    - run:
        name: Python stats
        when: always
        command: |
          pipdeptree | tee  build-stats/pipdeptree.txt
          python3 -m pip  list   | sort | tee  build-stats/pip-list.txt
          python3 -m pip  freeze | sort | tee  build-stats/pip-freeze.txt

    - store_artifacts:
        path: build-stats
        destination: build-stats

    - run:
        name: setup.py develop
        command: |
          pip install -e . --prefix ~/.local --no-deps

    - run:
        name: Make docs
        command: |
          FILE=src/conf.py
          mkdir -p out/docs
          if test -f "$FILE"; then
              sphinx-build src out/docs
          fi

    - store_artifacts:
        path: out/docs
        destination: docs
    - run:
        background: true
        name: services
        command: |
          TARGET=services
          if make -n $TARGET ; then
              make $TARGET
          else
              echo "Target $TARGET not defined"
          fi
    - run:
        name: pre-circle-tests
        command: |
          TARGET=pre-circle-tests
          if make -n $TARGET ; then
              make $TARGET
          else
              echo "Target $TARGET not defined"
          fi


    # - run:
    #     name: Notebooks
    #     command: |
    #       make -C notebooks cleanup all


    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: post-circle-tests
        command: |
          TARGET=post-circle-tests
          if make -n $TARGET ; then
              make $TARGET
          else
              echo "Target $TARGET not defined"
          fi

    - store_test_results:
        path: out/test-results

    - run:
        name: Coverage report
        when: always
        command: |
          coverage combine || true
          coverage html -d out/coverage/${CIRCLE_NODE_INDEX}
          coverage xml

    - store_artifacts:
        path: out/coverage
        destination: coverage

    - store_artifacts:
        path: out/tests
        destination: tests

    - run:
        name: CodeCov
        when: always
        command: |
          bash <(curl -s https://codecov.io/bash)
    resource_class: medium
  test-3.9-stage:
    environment:
      COLUMNS: '160'
      # default is /usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      PATH: /root/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      COVER_PACKAGES: geometry,geometry.basic_utils,geometry.constants,geometry.distances,geometry.distances.generic,geometry.distances.spherical,geometry.formatting,geometry.manifolds,geometry.manifolds.differentiable_manifold,geometry.manifolds.embedding_relations,geometry.manifolds.euclidean,geometry.manifolds.exceptions,geometry.manifolds.group,geometry.manifolds.manifold_embedding_propagation,geometry.manifolds.manifold_relations,geometry.manifolds.matrix_lie_algebra,geometry.manifolds.matrix_lie_group,geometry.manifolds.matrix_lie_group_tangent,geometry.manifolds.matrix_linear_space,geometry.manifolds.point_set,geometry.manifolds.product_manifold,geometry.manifolds.special_euclidean_algebra,geometry.manifolds.special_euclidean_group,geometry.manifolds.special_orthogonal_algebra,geometry.manifolds.special_orthogonal_group,geometry.manifolds.sphere,geometry.manifolds.square,geometry.manifolds.tangent_bundle,geometry.manifolds.tests,geometry.manifolds.tests.checks_generation,geometry.manifolds.tests.embedding_test,geometry.manifolds.tests.manifold_tests,geometry.manifolds.tests.matrix_groups_tests,geometry.manifolds.tests.pickling_tests,geometry.manifolds.tests.sphere_tests,geometry.manifolds.todo,geometry.manifolds.todo.grassman,geometry.manifolds.todo.moebius,geometry.manifolds.todo.orthogonal_group,geometry.manifolds.todo.posdef_matrices,geometry.manifolds.todo.stiefel,geometry.manifolds.torus,geometry.manifolds.torus01,geometry.manifolds.translation_algebra,geometry.manifolds.translation_group,geometry.mds_algos,geometry.poses,geometry.poses_embedding,geometry.procrustes,geometry.rotations,geometry.rotations_embedding,geometry.spheres,geometry.spheres_embedding,geometry.subspaces,geometry.subspaces.subspaces,geometry.tex,geometry.types,geometry.unittests,geometry.unittests.distances_test,geometry.unittests.mds_test,geometry.unittests.misc_tests,geometry.unittests.poses_test,geometry.unittests.procrustes_test,geometry.unittests.quaternions_test,geometry.unittests.random_geometry_density_tests,geometry.unittests.random_geometry_tests,geometry.unittests.rotations_tests,geometry.unittests.spheres_tests,geometry.unittests.uniform_dist_pvalue_paranoia,geometry.unittests.utils,geometry.unittests.utils_test,geometry.utils,geometry.utils.numpy_backport,geometry.yaml_
      TEST_PACKAGES: geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry
    docker:
    - image: ${DOCKER_REGISTRY}/zupermind/zuper-ci-3.9:z7
      auth:
        username: $DOCKER_USERNAME
        password: $DOCKER_PASSWORD
    working_directory: ~/repo
    steps:
    - checkout
    - run:
        name: Build statistics
        command: |
          mkdir -p build-stats
          env | sort | tee  build-stats/env.txt
    - store_artifacts:
        path: build-stats
        destination: build-stats
    - run:
        name: Install deps
        command: |
          shyaml get-values install_requires < project.pp1.yaml > .requirements.txt
          python3 -m pip install -U pip
          python3 -m pip install  -r .requirements.txt
          rm .requirements.txt

    - run:
        name: Install testing deps
        command: |
          shyaml get-values tests_require < project.pp1.yaml > .requirements_tests.txt
          python3 -m pip  install -r .requirements_tests.txt
          rm .requirements_tests.txt

    - run:
        name: Python stats
        when: always
        command: |
          pipdeptree | tee  build-stats/pipdeptree.txt
          python3 -m pip  list   | sort | tee  build-stats/pip-list.txt
          python3 -m pip  freeze | sort | tee  build-stats/pip-freeze.txt

    - store_artifacts:
        path: build-stats
        destination: build-stats

    - run:
        name: setup.py develop
        command: |
          pip install -e . --prefix ~/.local --no-deps

    - run:
        name: Make docs
        command: |
          FILE=src/conf.py
          mkdir -p out/docs
          if test -f "$FILE"; then
              sphinx-build src out/docs
          fi

    - store_artifacts:
        path: out/docs
        destination: docs
    - run:
        background: true
        name: services
        command: |
          TARGET=services
          if make -n $TARGET ; then
              make $TARGET
          else
              echo "Target $TARGET not defined"
          fi
    - run:
        name: pre-circle-tests
        command: |
          TARGET=pre-circle-tests
          if make -n $TARGET ; then
              make $TARGET
          else
              echo "Target $TARGET not defined"
          fi


    # - run:
    #     name: Notebooks
    #     command: |
    #       make -C notebooks cleanup all


    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: post-circle-tests
        command: |
          TARGET=post-circle-tests
          if make -n $TARGET ; then
              make $TARGET
          else
              echo "Target $TARGET not defined"
          fi

    - store_test_results:
        path: out/test-results

    - run:
        name: Coverage report
        when: always
        command: |
          coverage combine || true
          coverage html -d out/coverage/${CIRCLE_NODE_INDEX}
          coverage xml

    - store_artifacts:
        path: out/coverage
        destination: coverage

    - store_artifacts:
        path: out/tests
        destination: tests

    - run:
        name: CodeCov
        when: always
        command: |
          bash <(curl -s https://codecov.io/bash)
    resource_class: medium
  test-3.9-prod:
    environment:
      COLUMNS: '160'
      # default is /usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      PATH: /root/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      COVER_PACKAGES: geometry,geometry.basic_utils,geometry.constants,geometry.distances,geometry.distances.generic,geometry.distances.spherical,geometry.formatting,geometry.manifolds,geometry.manifolds.differentiable_manifold,geometry.manifolds.embedding_relations,geometry.manifolds.euclidean,geometry.manifolds.exceptions,geometry.manifolds.group,geometry.manifolds.manifold_embedding_propagation,geometry.manifolds.manifold_relations,geometry.manifolds.matrix_lie_algebra,geometry.manifolds.matrix_lie_group,geometry.manifolds.matrix_lie_group_tangent,geometry.manifolds.matrix_linear_space,geometry.manifolds.point_set,geometry.manifolds.product_manifold,geometry.manifolds.special_euclidean_algebra,geometry.manifolds.special_euclidean_group,geometry.manifolds.special_orthogonal_algebra,geometry.manifolds.special_orthogonal_group,geometry.manifolds.sphere,geometry.manifolds.square,geometry.manifolds.tangent_bundle,geometry.manifolds.tests,geometry.manifolds.tests.checks_generation,geometry.manifolds.tests.embedding_test,geometry.manifolds.tests.manifold_tests,geometry.manifolds.tests.matrix_groups_tests,geometry.manifolds.tests.pickling_tests,geometry.manifolds.tests.sphere_tests,geometry.manifolds.todo,geometry.manifolds.todo.grassman,geometry.manifolds.todo.moebius,geometry.manifolds.todo.orthogonal_group,geometry.manifolds.todo.posdef_matrices,geometry.manifolds.todo.stiefel,geometry.manifolds.torus,geometry.manifolds.torus01,geometry.manifolds.translation_algebra,geometry.manifolds.translation_group,geometry.mds_algos,geometry.poses,geometry.poses_embedding,geometry.procrustes,geometry.rotations,geometry.rotations_embedding,geometry.spheres,geometry.spheres_embedding,geometry.subspaces,geometry.subspaces.subspaces,geometry.tex,geometry.types,geometry.unittests,geometry.unittests.distances_test,geometry.unittests.mds_test,geometry.unittests.misc_tests,geometry.unittests.poses_test,geometry.unittests.procrustes_test,geometry.unittests.quaternions_test,geometry.unittests.random_geometry_density_tests,geometry.unittests.random_geometry_tests,geometry.unittests.rotations_tests,geometry.unittests.spheres_tests,geometry.unittests.uniform_dist_pvalue_paranoia,geometry.unittests.utils,geometry.unittests.utils_test,geometry.utils,geometry.utils.numpy_backport,geometry.yaml_
      TEST_PACKAGES: geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry geometry geometry geometry geometry geometry
        geometry geometry geometry geometry
    docker:
    - image: ${DOCKER_REGISTRY}/zupermind/zuper-ci-3.9:z7
      auth:
        username: $DOCKER_USERNAME
        password: $DOCKER_PASSWORD
    working_directory: ~/repo
    steps:
    - checkout
    - run:
        name: Build statistics
        command: |
          mkdir -p build-stats
          env | sort | tee  build-stats/env.txt
    - store_artifacts:
        path: build-stats
        destination: build-stats
    - run:
        name: Install deps
        command: |
          shyaml get-values install_requires < project.pp1.yaml > .requirements.txt
          python3 -m pip install -U pip
          python3 -m pip install  -r .requirements.txt
          rm .requirements.txt

    - run:
        name: Install testing deps
        command: |
          shyaml get-values tests_require < project.pp1.yaml > .requirements_tests.txt
          python3 -m pip  install -r .requirements_tests.txt
          rm .requirements_tests.txt

    - run:
        name: Python stats
        when: always
        command: |
          pipdeptree | tee  build-stats/pipdeptree.txt
          python3 -m pip  list   | sort | tee  build-stats/pip-list.txt
          python3 -m pip  freeze | sort | tee  build-stats/pip-freeze.txt

    - store_artifacts:
        path: build-stats
        destination: build-stats

    - run:
        name: setup.py develop
        command: |
          pip install -e . --prefix ~/.local --no-deps

    - run:
        name: Make docs
        command: |
          FILE=src/conf.py
          mkdir -p out/docs
          if test -f "$FILE"; then
              sphinx-build src out/docs
          fi

    - store_artifacts:
        path: out/docs
        destination: docs
    - run:
        background: true
        name: services
        command: |
          TARGET=services
          if make -n $TARGET ; then
              make $TARGET
          else
              echo "Target $TARGET not defined"
          fi
    - run:
        name: pre-circle-tests
        command: |
          TARGET=pre-circle-tests
          if make -n $TARGET ; then
              make $TARGET
          else
              echo "Target $TARGET not defined"
          fi


    # - run:
    #     name: Notebooks
    #     command: |
    #       make -C notebooks cleanup all


    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: geometry
        command: |-
          set -euxo pipefail
          mkdir -p out/test-results
          xunit_output=$PWD/out/test-results/nose-${CIRCLE_NODE_INDEX}-geometry-xunit.xml
          nosetests \
              --rednose --immediate \
              --cover-tests --with-coverage \
              --with-xunit --xunit-file=${xunit_output} \
              --cover-package=${COVER_PACKAGES} \
              geometry
        when: always
    - run:
        name: post-circle-tests
        command: |
          TARGET=post-circle-tests
          if make -n $TARGET ; then
              make $TARGET
          else
              echo "Target $TARGET not defined"
          fi

    - store_test_results:
        path: out/test-results

    - run:
        name: Coverage report
        when: always
        command: |
          coverage combine || true
          coverage html -d out/coverage/${CIRCLE_NODE_INDEX}
          coverage xml

    - store_artifacts:
        path: out/coverage
        destination: coverage

    - store_artifacts:
        path: out/tests
        destination: tests

    - run:
        name: CodeCov
        when: always
        command: |
          bash <(curl -s https://codecov.io/bash)
    resource_class: medium

# sigil 86e0f54ccfe31de7a2f2a7ca787bace7
